{% extends 'base.html.jinja2' %} {% block head_content %}
<meta
  name="description"
  content="Forum du blog permettant de discuter, interagir et donner son avis sur le blog."
/>
<title>{% block title %}Bienvenue sur le forum du blog{% endblock %}</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.34/moment-timezone-with-data.min.js"></script>
{{ moment.include_moment() }} {% endblock %}

<!-- main -->
{% block main_content %}
<div class="main-content">
  <!-- Cadre extérieur -->
  <div class="outer-frame-politique">
    <!-- Cadre intérieur -->
    <div class="inner-frame-politique">
      <!-- Division de retour à la page de tous les sujets -->
      <div class="space2"></div>

      <div class="back-link-forum">
        <a class="btn-primary" href="{{ url_for('frontend.forum') }}"
          >Retour au forum</a
        >
      </div>

      <!-- Image du logo -->
      <div class="imgcontainer-form">
        <img
          src="{{ url_for('static', filename='Images/images_accueil/forum1.png') }}"
          alt="Titi à la table des discussion"
          class="avatar-form"
        />
      </div>

      <!-- Conteneur titre -->
      <div class="title-container-landing">
        <h1 class="h1-landing">Forum de discussion</h1>
      </div>

      <div class="space2"></div>
      <div class="separation"></div>
      <div class="space2"></div>

      <!-- Division pour image forum -->
      <div class="forum-image-container">
        <!-- Première photo -->
        <div class="forum-pic">
          <div class="forum-pic-left">
            <img
              src="{{ url_for('static', filename='Images/images_forum/forum4.png') }}"
              alt="Titi répare son vélo"
              class="forum-pic-img"
            />
          </div>

          <!-- Deuxième photo -->
          <div class="forum-pic-right">
            <img
              src="{{ url_for('static', filename='Images/images_forum/forum5.png') }}"
              alt="Titi fait de la peinture"
              class="forum-pic-img"
            />
          </div>
        </div>
      </div>

      <div class="space-form"></div>

      <!-- Séparation -->
      <hr class="politique-divider" />

      <!-- Conteneur du sujet -->
      <div
        class="container-subject-forum"
        role="region"
        aria-labelledby="subject-heading"
      >
        <h3 class="h3-forum">
          Discussion sur le sujet :
          <span class="subject-name">{{ subject.nom }}</span>
        </h3>
      </div>

      <!-- Conteneur formulaire des commentaires -->
      <div class="container-comment">
        <!-- Conteneur commentaire -->
        <div class="comment-avis">
          <h4 class="h4-forum">Vous pouvez laisser un commentaire :</h4>
        </div>

        <!-- Conteneur formulaire du commentaire -->
        <div class="form-base">
          <form
            id="addCommentSubject"
            method="POST"
            action="{{ url_for('user.comment_subject', subject_id=subject.id) }}"
          >
            <!-- Token de sécurité -->
            {{ formcomment.csrf_token }}

            <input type="hidden" name="subject_id" value="{{ subject.id }}" />
            <textarea
              name="comment_content"
              placeholder="Votre commentaire"
              required
            ></textarea>
            <div class="space-form"></div>
            <div class="separation"></div>
            <div class="space-form"></div>
            <button class="btn-primary-forum" type="submit">
              Poster le commentaire
            </button>
          </form>
        </div>
      </div>

      <!-- Espacement -->
      <div class="space2"></div>
      <div class="separation"></div>
      <div class="space2"></div>

      {% for comment in comment_subject %}

      <!-- Conteneur pour poster un commentaire -->
      <div class="comment">
          
          <!-- Conteneur de la photo de l'utilisateur qui a répondu -->
          <div class="comment-header">
            <img src="../../static/Images/images_forum/default.png"
                alt="Photo de profil par default" class="reply-profile-picture">

          <div class="comment-user-info">
            <strong class="user-pseudo">Utilisateur</strong>
            <span class="user-role"> a commenté </span>
            <small class="comment-date">
              Le {{ moment(comment.comment_date).format('DD-MM-YYYY à HH:mm') }}
            </small>
          </div>
        </div>

        <div class="separation"></div>

        <!-- Conteneur du contenu du commentaire -->
        <div class="content-comment">
          {{ comment.comment_content | replace('\n', '<br />') | safe }}
        </div>

        <div class="separation"></div>

        <!-- Conteneur de réponse à un commentaire -->
        <div class="reply-button-container">
          <!-- Lien permettant de répondre à un commentaire -->
          <a
            href="{{ url_for('user.reply_form_subject', comment_id=comment.id) }}"
            class="reply-button"
          >
            Répondre
          </a>

          <div class="space"></div>
        </div>
      </div>
    </div>

    <div class="inner-frame">
      
      <!-- Conteneur principal de réponses au commentaire -->
      <div class="replies-container">
        {% for reply in comment.replies %}

        <!-- Conteneur d'une réponse individuelle -->
        <div class="reply-card">

          <!-- Conteneur de la photo de l'utilisateur qui a répondu -->
          <div class="reply-header">
            <img src="../../static/Images/images_forum/default.png"
              alt="Photo de profil par default" class="reply-profile-picture">

            <!-- Conteneur du pseudo de l'utilisateur qui a répondu -->
            <div class="reply-info">
              <strong class="reply-user-pseudo"> Utilisateur </strong>
              <span class="reply-user-role"> a répondu </span>
              <small class="reply-date">
                Le {{ moment(reply.reply_date).format('DD-MM-YYYY à HH:mm') }}
              </small>
            </div>
          </div>

          <!-- Contenu de la réponse -->
          <div class="reply-body">
            <p class="reply-content">
              {{ reply.reply_content | replace('\n', '<br />') | safe }}
            </p>
          </div>
        </div>
        <div class="separation"></div>
        {% endfor %}
      </div>
      {% endfor %}
    </div>

    <div class="space2"></div>
    <div class="separation2"></div>
    <div class="space2"></div>

    <!-- Séparation -->
    <hr class="politique-divider" />

    <!-- Division de retour à la page d'accueil -->
    <div class="back-link-forum">
      <a class="btn-primary" href="{{ url_for('landing_page') }}">
        Retour à la page d'accueil
      </a>
    </div>

    {% endblock %}
  </div>
</div>
